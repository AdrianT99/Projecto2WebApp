<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core">
    <h:head>
        <title>tester</title>
    </h:head>
    <h:body>

        <div id="arrayDetalleProductos">

            <h:form id="formArrayDetalleProductos">

                <p:growl id="msgs" showDetail="true"/>
                
                <div id="bloque1">
                <p:panelGrid class = "login" columns="1">
                    Nombre: <p:inputText value="#{CostosController.productoTO.nombreProducto}"
                                             style="margin: auto;
                                              padding-top: -3px;
                                              width: 30%;
                                              height: 30px;"/>  
                        

                        <div class="p-field p-col-12 p-md-4">
                            <p:outputLabel for="@next" value="Tipo" />
                            <p:selectOneMenu id="option" value="#{CostosController.productoTO.tipo}">
                                <f:selectItem itemLabel="Select One" itemValue=""/>
                                <f:selectItem itemLabel="U" itemValue="Option1"/>
                                <f:selectItem itemLabel="D" itemValue="Option2"/>
                                <f:selectItem itemLabel="T" itemValue="Option3"/>
                            </p:selectOneMenu>
                        </div>
                        <div>
                            Descripcion: <p:inputTextarea value="#{CostosController.productoTO.descripcion}" rows="6" cols="33"
                                                          style="margin: auto;
                                                          width: 60%;
                                                          height: 150px;"/>
                        </div>
                    </p:panelGrid> 
                </div>

                <p:dataTable id="ListaDetalleProducto" widgetVar="ListaDetalleProducto" var="Detalle" value="#{CostosController.detalleProducto}"
                             editable="true">

                    <p:ajax event="rowEdit" listener="#{CostosController.onRowEdit}" update=":formArrayDetalleProductos:costoTemp"/>
                    <p:ajax event="rowEditCancel" listener="#{CostosController.onRowCancel}" update=":formArrayDetalleProductos:msgs"/>

                    <p:column headerText="Cantidad">

                        <p:cellEditor>

                            <f:facet name="output"><h:outputText value="#{Detalle.cantidad}"/></f:facet>
                            <f:facet name="input"><p:inputText id="modelInput" value="#{Detalle.cantidad}"
                                                               style="width:100%"/></f:facet>
                        </p:cellEditor>

                    </p:column>

                    <p:column headerText="Costo Unitario">

                        <p:cellEditor>

                            <f:facet name="output"><h:outputText value="#{Detalle.costoUnitario}"/></f:facet>
                            <f:facet name="input"><p:inputText value="#{Detalle.costoUnitario}" style="width:100%"
                                                               label="Name"/></f:facet>
                        </p:cellEditor>

                    </p:column>

                    <p:column headerText="Descripcion">

                        <p:cellEditor>

                            <f:facet name="output"><h:outputText value="#{Detalle.descripcion}"/></f:facet>
                            <f:facet name="input"><p:inputText value="#{Detalle.descripcion}" style="width:100%"
                                                               label="Name"/></f:facet>
                        </p:cellEditor>

                    </p:column>

                    <p:column headerText="Total">

                        <p:cellEditor>

                            <f:facet name="output"><h:outputText value="#{Detalle.total}"/></f:facet>
                            <f:facet name="input"><p:inputText value="#{Detalle.total}" style="width:100%"
                                                               label="Price"/></f:facet>
                        </p:cellEditor>

                    </p:column>

                    <p:column style="width:6rem">
                        <p:rowEditor/>
                    </p:column>

                </p:dataTable>

                <div class="grid mt-3">

                    <div class="col-12">

                        <p:commandButton value="Agregar" process="@this" update=":formArrayDetalleProductos:msgs"
                                         action="#{CostosController.onAddNew()}" oncomplete="PF('ListaDetalleProducto').addRow();"/>
                    </div>

                </div>

                <div id="calculosArrayDetalleProductos">
                    <h:panelGrid columns="2" cellpadding="7" id="costoTemp">
                        <h:outputText value="Costo Total"/>
                        <h:outputLabel value="#{CostosController.costoTotal}">
                            <f:convertNumber type="currency" currencySymbol="$"/>
                        </h:outputLabel>

                        <h:outputText value="Margen"/>
                        <p:inputNumber id="margen" decimalPlaces="0" maxValue="100" value="#{CostosController.margen}">
                            <p:ajax update="margen" />
                        </p:inputNumber>
                        <!--<p:inputNumber value="#{CostosController.margen}"/>-->

                        <h:outputText value="Precio Sugerido"/>
                        <h:outputLabel value="#{CostosController.precioSugerido}">
                            <f:convertNumber type="currency" currencySymbol="$"/>
                        </h:outputLabel>

                        <h:outputText value="Precio Final"/>
                        <p:inputNumber id="PrecioFinal" decimalPlaces="0" maxValue="100" value="#{CostosController.precioFinal}">
                            <p:ajax update="PrecioFinal" />
                        </p:inputNumber>

                    </h:panelGrid>
                </div>

                <div id="botonesCalculos" style="float: left;
                     margin: auto;">
                    <p:commandButton value="Calcular" process="@this" update=":formArrayDetalleProductos:costoTemp" 
                                     actionListener="#{CostosController.calcularPrecioSugerido()}"/>
                    
                    <p:commandButton value="Guardar" process="@this" update="formArrayDetalleProductos" 
                                     action="#{CostosController.mensaje()}"/>
                </div>

            </h:form>
        </div>

    </h:body>
</html>
